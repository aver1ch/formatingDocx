╔══════════════════════════════════════════════════════════════════════════════╗
║                                                                              ║
║          🚀 ФАЗА 2 ЭТАП 3: PREFACEPROCESSOR + APPENDIXPROCESSOR            ║
║                                                                              ║
║                       ПЛАН РЕАЛИЗАЦИИ И ИНСТРУКЦИИ                          ║
║                                                                              ║
╚══════════════════════════════════════════════════════════════════════════════╝

📊 ТЕКУЩИЙ СТАТУС
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ Phase 2 Stage 1: SectionProcessor         [DONE]  18 tests
✅ Phase 2 Stage 2: TOCProcessor             [DONE]  34 tests
🟡 Phase 2 Stage 3: Preface + Appendix      [NOW]   15-25 tests
⬜ Phase 2 Stage 4: Final validation        [PLAN]

Total tests now: 75/75 ✅
Target after Stage 3: 90-100 tests

GOST Compliance:
├─ After Stage 2: 58%
├─ Target Stage 3: 68% (+10%)
└─ Final target: 77%

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎯 ЧТО НУЖНО РЕАЛИЗОВАТЬ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1️⃣ PrefaceProcessor - Предисловие/Преамбула
   ════════════════════════════════════════════

   Функционал:
   ├─ Добавление предисловия в документ (после титула, перед основным текстом)
   ├─ Форматирование как отдельный раздел
   ├─ Поддержка кастомного содержания
   ├─ Управление через конфигурацию (enabled, content)
   ├─ Правильное позиционирование в документе
   └─ Сохранение форматирования

   Конфигурация (PrefaceConfig):
   ├─ enabled: bool = False
   └─ content: str = ""

   Файлы:
   └─ doc_editor/processors/preface_processor.py (STUB готов, нужна реализация)

   Методы:
   ├─ __init__(config)
   ├─ add_preface(document)
   ├─ _create_preface_paragraph()
   ├─ _insert_preface_to_document()
   └─ Additional helper methods


2️⃣ AppendixProcessor - Приложения
   ════════════════════════════════════

   Функционал:
   ├─ Обработка приложений с буквенной нумерацией (А, Б, В... или A, B, C...)
   ├─ Автоматическое добавление "Приложение X"
   ├─ Поддержка двух стилей нумерации (letters, numbers)
   ├─ Управление через конфигурацию
   ├─ Позиционирование в конце документа
   └─ Правильное форматирование заголовков приложений

   Конфигурация (AppendixConfig):
   ├─ enabled: bool = False
   ├─ numbering_style: str = "letters"  # letters (A,Б,В) или numbers (1,2,3)
   └─ Additional options: start_letter, title_style, etc.

   Файлы:
   └─ doc_editor/processors/appendix_processor.py (STUB готов, нужна реализация)

   Методы:
   ├─ __init__(config)
   ├─ process_appendices(document)
   ├─ _find_appendix_headings()
   ├─ _get_appendix_letter()
   ├─ _apply_appendix_numbering()
   └─ Additional helper methods

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 РЕКОМЕНДУЕМЫЙ ПОДХОД (TDD)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ШАГ 1: Создать тесты для PrefaceProcessor (~10-12 тестов)
═════════════════════════════════════════════════════════════
Типы тестов:
├─ Инициализация (2 теста)
├─ Включение/отключение (2 теста)
├─ Добавление предисловия (3 теста)
├─ Форматирование (2 теста)
├─ Граничные случаи (2 теста)
└─ Интеграция (1-2 теста)

Файл: doc_editor/tests/test_preface_processor.py

ШАГ 2: Реализовать PrefaceProcessor
═════════════════════════════════════
Файл: doc_editor/processors/preface_processor.py
Методы: 5-7 методов

ШАГ 3: Создать тесты для AppendixProcessor (~8-12 тестов)
══════════════════════════════════════════════════════════════
Типы тестов:
├─ Инициализация (2 теста)
├─ Включение/отключение (2 теста)
├─ Поиск приложений (2 теста)
├─ Нумерация (letters и numbers) (3 теста)
├─ Форматирование (2 теста)
└─ Граничные случаи (1-2 теста)

Файл: doc_editor/tests/test_appendix_processor.py

ШАГ 4: Реализовать AppendixProcessor
════════════════════════════════════════
Файл: doc_editor/processors/appendix_processor.py
Методы: 6-8 методов

ШАГ 5: Интегрировать в Pipeline
════════════════════════════════════
Файл: doc_editor/pipeline.py
Добавить:
├─ Импорты для PrefaceProcessor и AppendixProcessor
├─ Вызовы в _apply_settings_after_structure()
├─ Этап 6: Добавление предисловия (после TOCProcessor)
└─ Этап 7: Обработка приложений (в конце)

ШАГ 6: Валидировать все тесты
═════════════════════════════════
pytest doc_editor/tests/ -v
Ожидаемый результат: 90-100 тестов пройдено

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔍 ДЕТАЛИ РЕАЛИЗАЦИИ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

PrefaceProcessor - Специфика
─────────────────────────────

Что это:
- Предисловие - это раздел документа, который идет после титула и оглавления
- Обычно используется для введения в документ, описания целей, задач
- Отделяется от основного текста

Позиционирование:
- Вставляется после титула (если есть)
- Вставляется после оглавления (если есть)
- Вставляется перед основным содержимым

Форматирование:
- Может быть со своим заголовком или без
- Обычно стиль Normal или Heading 1
- Может содержать нумерованные или маркированные списки

Конфигурация:
```yaml
document:
  structure:
    document_structure:
      preface:
        enabled: true
        content: |
          Это содержание предисловия.
          Может быть многострочным.
          Будет вставлено как раздел документа.
```


AppendixProcessor - Специфика
──────────────────────────────

Что это:
- Приложения - это разделы в конце документа с дополнительной информацией
- Нумеруются буквами (А, Б, В или A, B, C) или цифрами
- Каждое приложение - это отдельный раздел

Позиционирование:
- Вставляются в конец документа
- После основного содержимого
- После приложений других типов (если они есть)

Обнаружение приложений:
- Поиск заголовков, содержащих "Приложение", "Appendix", "App."
- Автоматическая нумерация найденных приложений

Форматирование:
- Заголовок: "Приложение А. Название приложения" или "Приложение A. Title"
- Стиль: Heading 1 или Heading 2
- Внутреннее содержимое остается без изменений

Нумерация:
- Style "letters": А, Б, В, Г, Д, Е, Ж, З, И, К (кириллица)
- Style "numbers": 1, 2, 3, 4, 5, 6, 7, 8, 9, 10

Конфигурация:
```yaml
document:
  structure:
    document_structure:
      appendix:
        enabled: true
        numbering_style: "letters"  # или "numbers"
```

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📚 ПРИМЕР ИСПОЛЬЗОВАНИЯ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Документ с Preface и Appendices:
─────────────────────────────────

ТИТУЛЬНЫЙ ЛИСТ
──────────────

ОГЛАВЛЕНИЕ
──────────

ПРЕДИСЛОВИЕ
───────────
Содержание предисловия идет здесь.
Это может быть вводная информация.

ОСНОВНОЙ ТЕКСТ
───────────────
1. Введение
   1.1 Подраздел
   1.1.1 Детали

2. Методология

3. Результаты

ПРИЛОЖЕНИЕ А. Дополнительные данные
────────────────────────────────────
Содержание приложения А...

ПРИЛОЖЕНИЕ Б. Таблицы результатов
──────────────────────────────────
Содержание приложения Б...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🚀 НАЧАЛО РАБОТЫ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. Начните с создания тестов для PrefaceProcessor
   → doc_editor/tests/test_preface_processor.py

2. Затем реализуйте PrefaceProcessor
   → doc_editor/processors/preface_processor.py

3. Повторите для AppendixProcessor
   → Сначала тесты, потом реализация

4. Интегрируйте в Pipeline
   → doc_editor/pipeline.py

5. Запустите все тесты и убедитесь что 90+ тестов проходят

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✨ Готовы начинать? Следуйте плану выше, начиная с создания тестов!
